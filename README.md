# Пример применения рефакторинга (Kotlin)

## Источник

[Мартин Фаулер. Рефакторинг. 2-е издание.](https://martinfowler.com/books/refactoring.html)

В примере рассматривается задача из [главы 1](https://files.thoughtworks.com/pdfs/Refactoring2-free-chapter.pdf) (доступна свободно)
и применяются аналогичные разобранным в книге Фаулера преобразования кода.

## Предметная область

В задаче требуется печатать счета, которые театральная компания выставляет 
своим клиентам. Клиент заказывает театральной компании представление 
(исполнение некоторой пьесы) и оплачивает заказ в зависимости от 
количества слушателей и типа (жанра) пьесы. Клиент также получает кредит,
который можно использовать при оплате следующих заказов. Объём кредита
также вычисляется в зависимости от количества слушателей и типа пьесы.

## Цель рефакторинга

Упростить реализацию в дальнейшем новых возможностей:
  * форматирование счёта в HTML;
  * добавление новых типов пьес.

## Последовательность шагов

1. Исправление предупреждений IDE.
2. Замена строк для типов пьес на Enum-класс:
   * добавление типа;
   * изменение данных;
   * изменение тестов.
3. Декомпозиция функции `statement`:
   * выделение функций;
   * переименование переменных.
4. Отделение вычислений от форматирования:
   * разбиение циклов;
   * замена циклов на функции;
   * замена изменяемых переменных на неизменяемые;
   * введение промежуточных форм данных.
5. Реорганизация вычислений по типам представлений:
   * выделение функций;
   * замена условных конструкций на табличный метод.
6. Разбиение на файлы.
